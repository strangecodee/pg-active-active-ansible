
{% raw %}
# Include existing pg_hba entries
{% include '/etc/postgresql/16/main/pg_hba.conf.orig' ignore missing %}

# ---- Custom HA Entries (appended) ----
{% endraw %}
# ... rest of your current template content ...

# Local
local   all             postgres                                peer

# Application via VIP
host    all             all             {{ vip_ip }}/32          scram-sha-256

# Replication user
host    replication     {{ repl_user }}  10.0.0.0/24             scram-sha-256

# FDW / internal traffic
host    all             {{ repl_user }}  10.0.0.0/24             scram-sha-256
